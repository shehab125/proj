<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تسجيل حساب مريض - الصندوق الطبي الذكي</title>
    <link rel="stylesheet" href="../css/style.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <!-- Google Fonts - Cairo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <div class="container">
                <a class="navbar-brand" href="../index.html">
                    <img src="../images/pattern-bg.png" alt="الصندوق الطبي الذكي" height="50">
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link" href="../index.html">الرئيسية</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="about.html">نبذة عن المشروع</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="features.html">المميزات والتقنيات</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="components.html">المكونات</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="demo.html">العروض التوضيحية</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="faq.html">الأسئلة الشائعة</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="contact.html">تواصل معنا</a>
                        </li>
                    </ul>
                    <div class="d-flex">
                        <a href="login.html" class="btn btn-outline-primary me-2">تسجيل الدخول</a>
                        <a href="signup.html" class="btn btn-primary active">إنشاء حساب</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <!-- Signup Section -->
    <section class="auth-section">
        <div class="container mt-5 pt-5">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="card shadow">
                        <div class="card-body">
                            <div class="text-center mb-4">
                                <h2>إنشاء حساب مريض</h2>
                                <p class="text-muted">أدخل بياناتك لإنشاء حساب مريض جديد</p>
                            </div>
                            
                            <ul class="nav nav-pills mb-4 justify-content-center" id="userTypeTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="doctor-tab" href="doctor-signup.html" role="tab" aria-controls="doctor" aria-selected="false">طبيب</a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link active" id="patient-tab" href="patient-signup.html" role="tab" aria-controls="patient" aria-selected="true">مريض</a>
                                </li>
                            </ul>
                            
                            <form id="patientSignupForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="firstName" class="form-label">الاسم الأول</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            <input type="text" class="form-control" id="firstName" name="firstName" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="lastName" class="form-label">الاسم الأخير</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user"></i></span>
                                            <input type="text" class="form-control" id="lastName" name="lastName" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="email" class="form-label">البريد الإلكتروني</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                            <input type="email" class="form-control" id="email" name="email" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="phone" class="form-label">رقم الهاتف</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                            <input type="tel" class="form-control" id="phone" name="phone" required>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="dateOfBirth" class="form-label">تاريخ الميلاد</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                            <input type="date" class="form-control" id="dateOfBirth" name="dateOfBirth" required>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="gender" class="form-label">الجنس</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-venus-mars"></i></span>
                                            <select class="form-select" id="gender" name="gender" required>
                                                <option value="" selected disabled>اختر الجنس</option>
                                                <option value="male">ذكر</option>
                                                <option value="female">أنثى</option>
                                                <option value="other">أخرى</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="bloodType" class="form-label">فصيلة الدم</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-tint"></i></span>
                                            <select class="form-select" id="bloodType" name="bloodType">
                                                <option value="" selected disabled>اختر فصيلة الدم</option>
                                                <option value="A+">A+</option>
                                                <option value="A-">A-</option>
                                                <option value="B+">B+</option>
                                                <option value="B-">B-</option>
                                                <option value="AB+">AB+</option>
                                                <option value="AB-">AB-</option>
                                                <option value="O+">O+</option>
                                                <option value="O-">O-</option>
                                                <option value="unknown">غير معروف</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="height" class="form-label">الطول (سم)</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-ruler-vertical"></i></span>
                                            <input type="number" class="form-control" id="height" name="height" min="50" max="250">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="weight" class="form-label">الوزن (كجم)</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-weight"></i></span>
                                            <input type="number" class="form-control" id="weight" name="weight" min="1" max="500">
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="deviceId" class="form-label">رقم جهاز الصندوق الطبي</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-box-open"></i></span>
                                            <input type="text" class="form-control" id="deviceId" name="deviceId" placeholder="اختياري">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="allergies" class="form-label">الحساسية</label>
                                    <textarea class="form-control" id="allergies" name="allergies" rows="2" placeholder="أدخل أي حساسية لديك (مثل: البنسلين، المكسرات، إلخ)"></textarea>
                                </div>
                                
                                <div class="mb-3">
                                    <label for="chronicConditions" class="form-label">الأمراض المزمنة</label>
                                    <textarea class="form-control" id="chronicConditions" name="chronicConditions" rows="2" placeholder="أدخل أي أمراض مزمنة لديك (مثل: السكري، ضغط الدم، إلخ)"></textarea>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="emergencyContactName" class="form-label">اسم جهة الاتصال في حالات الطوارئ</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user-shield"></i></span>
                                            <input type="text" class="form-control" id="emergencyContactName" name="emergencyContactName">
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="emergencyContactPhone" class="form-label">رقم هاتف جهة الاتصال في حالات الطوارئ</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-phone-alt"></i></span>
                                            <input type="tel" class="form-control" id="emergencyContactPhone" name="emergencyContactPhone">
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="password" class="form-label">كلمة المرور</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                            <input type="password" class="form-control" id="password" name="password" required>
                                            <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="confirmPassword" class="form-label">تأكيد كلمة المرور</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-lock"></i></span>
                                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" required>
                                            <button class="btn btn-outline-secondary" type="button" id="toggleConfirmPassword">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-3 form-check">
                                    <input type="checkbox" class="form-check-input" id="terms" required>
                                    <label class="form-check-label" for="terms">
                                        أوافق على <a href="terms.html">الشروط والأحكام</a> و <a href="privacy.html">سياسة الخصوصية</a>
                                    </label>
                                </div>
                                
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary">إنشاء حساب مريض</button>
                                </div>
                                
                                <div class="text-center mt-3">
                                    <p>لديك حساب بالفعل؟ <a href="login.html">تسجيل الدخول</a></p>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-light mt-5">
        <div class="container py-4">
            <div class="row">
                <div class="col-md-4">
                    <h5>عن المشروع</h5>
                    <p>الصندوق الطبي الذكي هو مشروع مبتكر يهدف إلى تحسين إدارة الأدوية وتتبع الحالة الصحية للمرضى.</p>
                </div>
                <div class="col-md-4">
                    <h5>روابط سريعة</h5>
                    <ul class="list-unstyled">
                        <li><a href="../index.html">الرئيسية</a></li>
                        <li><a href="about.html">نبذة عن المشروع</a></li>
                        <li><a href="features.html">المميزات والتقنيات</a></li>
                        <li><a href="contact.html">تواصل معنا</a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <h5>تواصل معنا</h5>
                    <ul class="list-unstyled">
                        <li><i class="fas fa-envelope"></i> info@smartmedicalbox.com</li>
                        <li><i class="fas fa-phone"></i> +1234567890</li>
                    </ul>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // تبديل عرض كلمة المرور
            document.getElementById('togglePassword').addEventListener('click', function() {
                const passwordInput = document.getElementById('password');
                const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                passwordInput.setAttribute('type', type);
                this.querySelector('i').classList.toggle('fa-eye');
                this.querySelector('i').classList.toggle('fa-eye-slash');
            });
            
            document.getElementById('toggleConfirmPassword').addEventListener('click', function() {
                const confirmPasswordInput = document.getElementById('confirmPassword');
                const type = confirmPasswordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                confirmPasswordInput.setAttribute('type', type);
                this.querySelector('i').classList.toggle('fa-eye');
                this.querySelector('i').classList.toggle('fa-eye-slash');
            });
            
            // معالجة إرسال النموذج
            document.getElementById('patientSignupForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // التحقق من تطابق كلمات المرور
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                if (password !== confirmPassword) {
                    alert('كلمة المرور غير متطابقة');
                    return;
                }
                
                // جمع بيانات النموذج
                const formData = {
                    first_name: document.getElementById('firstName').value,
                    last_name: document.getElementById('lastName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    password: password,
                    user_type: 'patient',
                    patient_profile: {
                        date_of_birth: document.getElementById('dateOfBirth').value,
                        gender: document.getElementById('gender').value,
                        blood_type: document.getElementById('bloodType').value,
                        height: document.getElementById('height').value,
                        weight: document.getElementById('weight').value,
                        allergies: document.getElementById('allergies').value,
                        chronic_conditions: document.getElementById('chronicConditions').value,
                        emergency_contact_name: document.getElementById('emergencyContactName').value,
                        emergency_contact_phone: document.getElementById('emergencyContactPhone').value,
                        device_id: document.getElementById('deviceId').value
                    }
                };
                
                try {
                    // إرسال البيانات إلى الخادم
                    const response = await fetch('http://localhost:5000/api/users/signup', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        // حفظ التوكن في localStorage
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('user', JSON.stringify(data.user));
                        
                        // توجيه المستخدم إلى لوحة التحكم
                        window.location.href = 'patient-dashboard.html';
                    } else {
                        alert(data.error || 'حدث خطأ أثناء إنشاء الحساب');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    alert('حدث خطأ أثناء الاتصال بالخادم');
                }
            });
        });
    </script>
</body>
</html>
